<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TKD NOVA LEADERBOARD</title> 
    
    <style>
        /* --- THEME DEFINITIONS --- */
        
        /* Default: Dark Theme */
        :root, [data-theme="dark-theme"] {
            --primary-color: #f8f8f8; 
            --secondary-color: #DA291C; /* Red/Ghong accent */
            --accent-color: #FFC300; /* Gold */
            --dark-bg: #1e1e1e; 
            --card-bg: #2d2d2d; 
            --border-color: #444;
            --hover-color: #3a3a3a;
            /* Medal Colors */
            --gold: #FFD700;
            --silver: #C0C0C0;
            --bronze: #CD7F32;
            /* Rank Badge Color */
            --rank-badge-bg: #DA291C; 
            --rank-badge-text: #FFFFFF;
        }

        /* Red/Light Theme */
        [data-theme="red-theme"] {
            --primary-color: #1e1e1e;
            --secondary-color: #FFFFFF; 
            --accent-color: #DA291C; /* Primary Red accent */
            --dark-bg: #f8f8f8;
            --card-bg: #FFFFFF;
            --border-color: #ccc;
            --hover-color: #f0f0f0;
            /* Rank Badge Color */
            --rank-badge-bg: #000000; 
            --rank-badge-text: #FFC300;
        }

        /* Status Colors (Same for both themes) */
        :root {
            --status-active: #4CAF50; 
            --status-coach: #2196F3; 
            --status-injured: #FFC300; 
            --status-retired: #9E9E9E; 
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--dark-bg);
            color: var(--primary-color);
            margin: 0;
            padding: 0;
            line-height: 1.6;
            transition: background-color 0.5s, color 0.5s; /* Smooth theme transition */
        }

        #main-header {
            background-color: #000000;
            padding: 20px 50px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
        }

        #main-header h1 {
            margin: 0;
            font-size: 2.2em;
            color: var(--accent-color); 
        }

        #dashboard {
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            animation: fadeIn 1s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Filter Section Styling */
        #controls {
            grid-column: 1 / -1;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px; 
            padding: 15px 25px;
            background-color: var(--card-bg);
            border-radius: 12px;
            border: 1px solid var(--border-color);
        }

        #controls label {
            font-weight: bold;
            color: var(--accent-color);
        }

        #division-filter, #country-filter, #theme-toggle, #language-switch { 
            padding: 10px 15px;
            border-radius: 6px;
            border: 1px solid var(--border-color);
            background-color: var(--hover-color);
            color: var(--primary-color);
            appearance: none; 
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        /* Light Theme Adjustments for Controls */
        [data-theme="red-theme"] #division-filter, 
        [data-theme="red-theme"] #country-filter,
        [data-theme="red-theme"] #theme-toggle,
        [data-theme="red-theme"] #language-switch {
            color: var(--primary-color);
            background-color: #e0e0e0;
            border-color: #aaa;
        }


        /* Shared Card Styling (leaderboard & analysis) */
        #leaderboard-section, #analysis-section {
            background-color: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--border-color);
        }
        
        [data-theme="red-theme"] #leaderboard-section, 
        [data-theme="red-theme"] #analysis-section {
             box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        }
        
        h2, h4 {
            color: var(--secondary-color);
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 15px;
            margin-top: 0;
            transition: color 0.5s, border-color 0.5s;
        }
        
        [data-theme="red-theme"] h2, [data-theme="red-theme"] h4 {
            color: var(--accent-color);
            border-bottom-color: var(--accent-color);
        }


        /* Leaderboard Specifics */
        #leaderboard-list {
            list-style: none;
            padding: 0;
        }

        #leaderboard-list li {
            display: flex;
            justify-content: space-between; 
            align-items: center;
            padding: 15px 10px;
            border-bottom: 1px dashed var(--border-color);
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
        }

        #leaderboard-list li:hover {
            background-color: var(--hover-color);
            transform: scale(1.02); 
        }
        
        /* Light Theme adjustment for list item hover/border */
        [data-theme="red-theme"] #leaderboard-list li {
            border-bottom-color: #ddd;
        }
        [data-theme="red-theme"] #leaderboard-list li:hover {
            background-color: var(--hover-color);
        }


        .rank {
            font-weight: bold;
            font-size: 1.4em;
            color: var(--accent-color); 
            width: 40px; 
            text-align: center;
            flex-shrink: 0;
        }
        
        .name-container {
            flex-grow: 1;
            display: flex;
            align-items: center;
            font-size: 1.1em;
            padding-right: 20px; 
        }
        
        /* --- RANK BADGE STYLE (Used in Analysis H3 and Accolades) --- */
        .rank-badge {
            background-color: var(--rank-badge-bg);
            color: var(--rank-badge-text);
            font-size: 0.75em;
            font-weight: 700;
            padding: 3px 8px;
            margin-left: 15px;
            border-radius: 4px;
            letter-spacing: 0.5px;
            border: 1px solid var(--accent-color);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.4);
            display: inline-block; 
            vertical-align: middle;
            white-space: nowrap; /* Prevent badge text wrap */
        }
        /* --------------------------- */


        .stats-container {
            display: flex;
            align-items: center;
            gap: 10px; 
            flex-shrink: 0;
        }

        /* Flag Styling */
        .flag-img {
            width: 30px; 
            height: 20px;
            border: 1px solid #333;
            margin-right: 10px;
            border-radius: 3px;
            object-fit: cover;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            /* Used in h3 */
            line-height: 1;
        }
        
        .status-badge {
            font-size: 0.8em;
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
            line-height: 1;
        }
        .status-badge.Active { background-color: var(--status-active); color: var(--dark-bg); }
        .status-badge.Coach { background-color: var(--status-coach); color: var(--primary-color); }
        .status-badge.Injured { background-color: var(--status-injured); color: var(--dark-bg); }
        .status-badge.Retired { background-color: var(--status-retired); color: var(--primary-color); }
        
        .ratio-display {
            font-style: italic;
            color: #ccc;
            font-weight: 500;
            width: 80px; 
            text-align: right;
        }
        
        [data-theme="red-theme"] .ratio-display {
            color: #666;
        }


        /* Analysis Section Styling */
        #fighter-detail {
            border: 1px solid var(--border-color);
            padding: 20px;
            border-radius: 12px;
            opacity: 0; 
            transition: opacity 0.5s ease-in-out;
            min-height: 200px;
        }
        
        [data-theme="red-theme"] #fighter-detail {
            border-color: #ddd;
        }
        
        #fighter-name {
            display: flex;
            align-items: center;
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .stat-line {
            display: flex;
            justify-content: space-between;
            border-bottom: 1px solid #3a3a3a;
            padding: 10px 0;
        }
        
        [data-theme="red-theme"] .stat-line {
            border-bottom-color: #e0e0e0;
        }

        .stat-line strong {
            color: var(--accent-color);
        }
        
        /* Probability Emphasis */
        #probability-score {
            font-size: 1.8em;
            font-weight: 900;
            color: var(--status-active); /* Green for positive prediction */
            padding-right: 5px;
        }
        
        /* --- Accolades Section Styling --- */
        #accolades-section {
            padding: 10px 0;
            display: flex;
            flex-wrap: wrap; /* Allow badges to wrap */
            gap: 10px;
            align-items: center;
            min-height: 40px; /* Ensure space even if no badges */
        }
        
        #accolades-section .no-badges {
            font-style: italic;
            color: #aaa;
            font-size: 0.9em;
        }
        
        /* --- Probability Breakdown Styles --- */
        #probability-breakdown {
            margin-top: 10px;
            padding: 10px;
            background-color: var(--hover-color);
            border-radius: 4px;
            border: 1px dashed var(--border-color);
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            
            overflow-y: hidden; /* Prevent scrolling when hidden */
            max-height: 0; /* Hidden by default */
            opacity: 0;
        }
        
        #probability-breakdown.visible {
            max-height: 120px; /* Fixed height when visible */
            opacity: 1;
            overflow-y: auto; /* Enable scroll if content exceeds 120px */
        }

        .breakdown-line {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            color: #ccc;
        }
        
        .breakdown-line .value {
            font-weight: bold;
            color: var(--accent-color);
        }

        /* Toggle Button */
        #breakdown-toggle {
            cursor: pointer;
            color: var(--secondary-color);
            font-weight: bold;
            font-size: 0.9em;
            text-align: right;
            display: block;
            margin-top: 5px;
            padding-top: 5px;
            transition: color 0.3s;
        }
        #breakdown-toggle:hover {
            color: var(--primary-color);
        }
        /* --- END NEW STYLES --- */
        
        
        /* History Table Styling */
        #history-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            font-size: 0.9em;
        }

        #history-table th, #history-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #3a3a3a;
        }
        
        [data-theme="red-theme"] #history-table th, 
        [data-theme="red-theme"] #history-table td {
            border-bottom-color: #ddd;
        }


        #history-table th {
            background-color: var(--hover-color);
            color: var(--secondary-color);
            font-weight: bold;
        }

        #history-table tr:nth-child(even) {
            background-color: #282828;
        }
        
        [data-theme="red-theme"] #history-table tr:nth-child(even) {
            background-color: #f5f5f5;
        }


        #initial-message {
            padding: 20px;
            text-align: center;
            color: #aaa;
            border: 2px dashed #444;
            border-radius: 8px;
        }
        
        [data-theme="red-theme"] #initial-message {
            color: #555;
            border-color: #aaa;
        }
        
        /* --- MEDAL COUNT STYLING --- */
        .medal-icon {
            font-size: 2.5em; 
            transition: transform 0.3s;
        }
        .medal-icon:hover {
            transform: scale(1.1);
        }

        /* ----------------------------------------------------------------- */
        /* --- RESPONSIVE DESIGN MEDIA QUERY --- */
        /* ----------------------------------------------------------------- */
        @media (max-width: 768px) {
            
            #main-header {
                padding: 15px 20px;
            }
            
            /* Stack the main sections vertically on mobile */
            #dashboard {
                grid-template-columns: 1fr;
                gap: 20px;
                margin: 20px auto;
                padding: 0 10px;
            }

            /* Stack controls vertically and use full width */
            #controls {
                flex-direction: column;
                align-items: stretch;
                padding: 15px;
                gap: 10px;
            }
            
            #controls label {
                margin-top: 5px;
                text-align: center;
            }

            #division-filter, #country-filter, #theme-toggle, #language-switch {
                width: 100%;
                box-sizing: border-box; 
            }
            
            /* Reduce padding on cards */
            #leaderboard-section, #analysis-section {
                padding: 15px;
            }
            
            /* Adjust leaderboard list item padding for better fit */
            #leaderboard-list li {
                padding: 10px 5px;
                font-size: 0.9em;
            }
            
            .rank {
                font-size: 1.2em;
                width: 30px;
            }
            
            .flag-img {
                width: 25px; 
                height: 16px;
                margin-right: 5px;
            }
            
            .status-badge {
                font-size: 0.7em;
                padding: 3px 6px;
            }
            
            .ratio-display {
                width: 70px;
                font-size: 0.9em;
            }
            
            .rank-badge { /* Smaller on mobile */
                font-size: 0.65em;
                padding: 3px 5px;
                margin-left: 10px;
            }
        }
        
        /* Utility */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body data-theme="dark-theme">

    <header id="main-header">
        <h1>TKD Nova Leaderboard</h1>
        <p data-localize="headerSubtitle">Global Rankings and Performance Analysis</p>
    </header>

    <main id="dashboard">
        
        <div id="controls">
            
            <label for="division-filter" data-localize="filterDivision">Filter by Division:</label>
            <select id="division-filter">
                <option value="All" data-localize="divisionAll">All Divisions</option>
                <option value="Senior" data-localize="divisionSenior">Senior (All)</option>
                <option value="Senior-Light" data-localize="seniorLight">Senior - Light</option>
                <option value="Senior-Middle" data-localize="seniorMiddle">Senior - Middle</option>
                <option value="Senior-Heavy" data-localize="seniorHeavy">Senior - Heavy</option>
                <option value="Junior" data-localize="divisionJunior">Junior (All)</option>
                <option value="Junior-Light" data-localize="juniorLight">Junior - Light</option>
                <option value="Junior-Middle" data-localize="juniorMiddle">Junior - Middle</option>
                <option value="Junior-Heavy" data-localize="juniorHeavy">Junior - Heavy</option>
                <option value="Cadet" data-localize="divisionCadet">Cadet (All)</option>
                <option value="Cadet-Light" data-localize="cadetLight">Cadet - Light</option>
                <option value="Cadet-Middle" data-localize="cadetMiddle">Cadet - Middle</option>
                <option value="Cadet-Heavy" data-localize="cadetHeavy">Cadet - Heavy</option>
            </select>
            
            <label for="country-filter" data-localize="filterCountry">Filter by Country:</label> 
            <select id="country-filter"> 
                <option value="All" data-localize="countryAll">All Countries</option>
                </select>
            
            <label for="theme-toggle" data-localize="filterTheme">Theme:</label>
            <select id="theme-toggle">
                <option value="dark-theme" data-localize="themeDark">Dark Mode (Default)</option>
                <option value="red-theme" data-localize="themeLight">Light/Red Theme</option>
            </select>

            <label for="language-switch" data-localize="filterLanguage">Language:</label>
            <select id="language-switch">
                <option value="en">English</option>
                <option value="ro">Rom√¢nƒÉ</option>
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            </select>
        </div>
        
        <section id="leaderboard-section">
            <h2 id="leaderboard-heading" data-localize="leaderboardHeading">üèÜ All Rankings (Sorted by Win Ratio)</h2>
            <ul id="leaderboard-list">
                </ul>
        </section>

        <section id="analysis-section">
            <h2 id="analysis-heading" data-localize="analysisHeading">üìä Fighter Performance Analysis</h2>
            
            <div id="initial-message">
                <p data-localize="initialMessage">Click a fighter on the **Leaderboard** to view their detailed performance statistics here.</p>
            </div>
            
            <div id="fighter-detail" class="hidden">
                <h3 id="fighter-name"></h3>
                
                <h4 data-localize="accoladesTitle" style="padding-top: 10px;">üëë Elite Status & Accolades</h4>
                <div id="accolades-section">
                    </div>
                
                <div class="stat-line"><p><strong data-localize="statStatus">Status:</strong></p><p id="fighter-status"></p></div>
                <div class="stat-line"><p><strong data-localize="statDivision">Division:</strong></p><p id="fighter-division"></p></div>
                <div class="stat-line"><p><strong data-localize="statWeight">Weight Class:</strong></p><p id="weight-class"></p></div>
                <div class="stat-line"><p><strong data-localize="statCountry">Country:</strong></p><p id="country-display"></p></div>
                <div class="stat-line"><p><strong data-localize="statRatio">Win/Loss Ratio:</strong></p><p id="win-loss"></p></div>
                <div class="stat-line"><p><strong data-localize="statWeightedScore">Weighted Medal Value (WMV):</strong></p><p id="weighted-medal-score" style="color: var(--accent-color); font-weight: bold;"></p></div>

                <h4 data-localize="probabilityTitle" style="padding-top: 20px;">üîÆ Next Match Win Probability</h4>
                <div class="stat-line" style="border-bottom: none; background-color: var(--hover-color); padding: 15px 10px; border-radius: 6px;">
                    <p style="font-size: 1.1em;"><strong data-localize="statProbability">Win Probability:</strong></p>
                    <p id="probability-score"></p>
                </div>
                
                <span id="breakdown-toggle" data-localize="toggleShowBreakdown">‚äû Show Breakdown</span>
                <div id="probability-breakdown">
                    <div class="breakdown-line"><p data-localize="breakdownRatio">Win Ratio Contribution (80%):</p><p class="value" id="ratio-contribution"></p></div>
                    <div class="breakdown-line"><p data-localize="breakdownWMV">WMV Contribution (20%):</p><p class="value" id="wmv-contribution"></p></div>
                    <div class="breakdown-line" style="border-top: 1px solid var(--border-color); margin-top: 5px;"><p data-localize="breakdownTotal">Unadjusted Total:</p><p class="value" id="unadjusted-total"></p></div>
                </div>

                
                <h4 data-localize="medalTitle" style="margin-top: 20px;">üèÖ Career Medals</h4>
                <div id="medal-count" style="display: flex; justify-content: space-around; padding: 10px 0;">
                    </div>
                
                <h4 data-localize="historyTitle">üèÖ Competition History</h4>
                <table id="history-table">
                    <thead><tr><th data-localize="historyTournament">Tournament</th><th data-localize="historyPlacement">Placement</th><th data-localize="historyYear">Year</th></tr></thead>
                    <tbody id="history-body"></tbody>
                </table>
            </div>
            
        </section>
        
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // --- LOCALIZATION DATA ---
            const localizationData = {
                'headerSubtitle': {'en': 'Global Rankings and Performance Analysis', 'ro': 'Clasamente Globale »ôi Analiza Performan»õei', 'ru': '–ú–∏—Ä–æ–≤—ã–µ –†–µ–π—Ç–∏–Ω–≥–∏ –∏ –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏'},
                
                'filterDivision': {'en': 'Filter by Division:', 'ro': 'Filtrare dupƒÉ Divizie:', 'ru': '–§–∏–ª—å—Ç—Ä –ø–æ –î–∏–≤–∏–∑–∏–æ–Ω—É:'},
                'divisionAll': {'en': 'All Divisions', 'ro': 'Toate Diviziile', 'ru': '–í—Å–µ –î–∏–≤–∏–∑–∏–æ–Ω—ã'},
                
                // Detailed Division Localization
                'divisionSenior': {'en': 'Senior (All)', 'ro': 'Senior (To»õi)', 'ru': '–°–µ–Ω—å–æ—Ä (–í—Å–µ)'},
                'seniorLight': {'en': 'Senior - Light', 'ro': 'Senior - U»ôoarƒÉ', 'ru': '–°–µ–Ω—å–æ—Ä - –õ–µ–≥–∫–∏–π'},
                'seniorMiddle': {'en': 'Senior - Middle', 'ro': 'Senior - Mijlocie', 'ru': '–°–µ–Ω—å–æ—Ä - –°—Ä–µ–¥–Ω–∏–π'},
                'seniorHeavy': {'en': 'Senior - Heavy', 'ro': 'Senior - Greu', 'ru': '–°–µ–Ω—å–æ—Ä - –¢—è–∂–µ–ª—ã–π'},
                
                'divisionJunior': {'en': 'Junior (All)', 'ro': 'Junior (To»õi)', 'ru': '–Æ–Ω–∏–æ—Ä (–í—Å–µ)'},
                'juniorLight': {'en': 'Junior - Light', 'ro': 'Junior - U»ôoarƒÉ', 'ru': '–Æ–Ω–∏–æ—Ä - –õ–µ–≥–∫–∏–π'},
                'juniorMiddle': {'en': 'Junior - Middle', 'ro': 'Junior - Mijlocie', 'ru': '–Æ–Ω–∏–æ—Ä - –°—Ä–µ–¥–Ω–∏–π'},
                'juniorHeavy': {'en': 'Junior - Heavy', 'ro': 'Junior - Greu', 'ru': '–Æ–Ω–∏–æ—Ä - –¢—è–∂–µ–ª—ã–π'},
                
                'divisionCadet': {'en': 'Cadet (All)', 'ro': 'Cadet (To»õi)', 'ru': '–ö–∞–¥–µ—Ç (–í—Å–µ)'},
                'cadetLight': {'en': 'Cadet - Light', 'ro': 'Cadet - U»ôoarƒÉ', 'ru': '–ö–∞–¥–µ—Ç - –õ–µ–≥–∫–∏–π'},
                'cadetMiddle': {'en': 'Cadet - Middle', 'ro': 'Cadet - Mijlocie', 'ru': '–ö–∞–¥–µ—Ç - –°—Ä–µ–¥–Ω–∏–π'},
                'cadetHeavy': {'en': 'Cadet - Heavy', 'ro': 'Cadet - Greu', 'ru': '–ö–∞–¥–µ—Ç - –¢—è–∂–µ–ª—ã–π'},
                
                'filterCountry': {'en': 'Filter by Country:', 'ro': 'Filtrare dupƒÉ »öarƒÉ:', 'ru': '–§–∏–ª—å—Ç—Ä –ø–æ –°—Ç—Ä–∞–Ω–µ:'},
                'countryAll': {'en': 'All Countries', 'ro': 'Toate »öƒÉrile', 'ru': '–í—Å–µ –°—Ç—Ä–∞–Ω—ã'},
                
                'filterTheme': {'en': 'Theme:', 'ro': 'TemƒÉ:', 'ru': '–¢–µ–º–∞:'},
                'themeDark': {'en': 'Dark Mode (Default)', 'ro': 'Mod √éntunecat (Implicit)', 'ru': '–¢–µ–º–Ω—ã–π –†–µ–∂–∏–º (–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é)'},
                'themeLight': {'en': 'Light/Red Theme', 'ro': 'TemƒÉ DeschisƒÉ/Ro»ôie', 'ru': '–°–≤–µ—Ç–ª—ã–π/–ö—Ä–∞—Å–Ω—ã–π –†–µ–∂–∏–º'},
                
                'filterLanguage': {'en': 'Language:', 'ro': 'LimbƒÉ:', 'ru': '–Ø–∑—ã–∫:'},
                
                'leaderboardHeading': {'en': 'üèÜ All Rankings (Sorted by Win Ratio)', 'ro': 'üèÜ Toate Clasamentele (Sortate dupƒÉ Rata de C√¢»ôtig)', 'ru': 'üèÜ –í—Å–µ –†–µ–π—Ç–∏–Ω–≥–∏ (–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—é –ü–æ–±–µ–¥)'},
                'analysisHeading': {'en': 'üìä Fighter Performance Analysis', 'ro': 'üìä Analiza Performan»õei LuptƒÉtorului', 'ru': 'üìä –ê–Ω–∞–ª–∏–∑ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ë–æ–π—Ü–∞'},
                'initialMessage': {'en': 'Click a fighter on the **Leaderboard** to view their detailed performance statistics here.', 'ro': 'Face»õi clic pe un luptƒÉtor din **Clasament** pentru a vedea statisticile detaliate ale performan»õei sale aici.', 'ru': '–ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±–æ–π—Ü–∞ –≤ **–†–µ–π—Ç–∏–Ω–≥–µ**, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –µ–≥–æ –ø–æ–¥—Ä–æ–±–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å.'},

                'statStatus': {'en': 'Status:', 'ro': 'Status:', 'ru': '–°—Ç–∞—Ç—É—Å:'},
                'statDivision': {'en': 'Division:', 'ro': 'Divizie:', 'ru': '–î–∏–≤–∏–∑–∏–æ–Ω:'},
                'statWeight': {'en': 'Weight Class:', 'ro': 'Clasa de Greutate:', 'ru': '–í–µ—Å–æ–≤–∞—è –ö–∞—Ç–µ–≥–æ—Ä–∏—è:'},
                'statCountry': {'en': 'Country:', 'ro': '»öarƒÉ:', 'ru': '–°—Ç—Ä–∞–Ω–∞:'},
                'statRatio': {'en': 'Win/Loss Ratio:', 'ro': 'Raport C√¢»ôtig/Pierdere:', 'ru': '–°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ –ü–æ–±–µ–¥/–ü–æ—Ä–∞–∂–µ–Ω–∏–π:'},
                'statWeightedScore': {'en': 'Weighted Medal Value (WMV):', 'ro': 'Valoarea PonderatƒÉ a Medaliei (WMV):', 'ru': '–í–∑–≤–µ—à–µ–Ω–Ω–∞—è –°—Ç–æ–∏–º–æ—Å—Ç—å –ú–µ–¥–∞–ª–µ–π (WMV):'},
                
                'probabilityTitle': {'en': 'üîÆ Next Match Win Probability', 'ro': 'üîÆ Probabilitatea de C√¢»ôtig la UrmƒÉtorul Meci', 'ru': 'üîÆ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ü–æ–±–µ–¥—ã –≤ –°–ª–µ–¥—É—é—â–µ–º –ú–∞—Ç—á–µ'},
                'statProbability': {'en': 'Win Probability:', 'ro': 'Probabilitatea de C√¢»ôtig:', 'ru': '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –ü–æ–±–µ–¥—ã:'},
                
                'toggleShowBreakdown': {'en': '‚äû Show Breakdown', 'ro': '‚äû AratƒÉ Detaliile', 'ru': '‚äû –ü–æ–∫–∞–∑–∞—Ç—å –î–µ—Ç–∞–ª–∏'},
                'toggleHideBreakdown': {'en': '‚äü Hide Breakdown', 'ro': '‚äü Ascunde Detaliile', 'ru': '‚äü –°–∫—Ä—ã—Ç—å –î–µ—Ç–∞–ª–∏'},
                'breakdownRatio': {'en': 'Win Ratio Contribution (80%):', 'ro': 'Contribu»õia Rata de C√¢»ôtig (80%):', 'ru': '–í–∫–ª–∞–¥ –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏—è –ü–æ–±–µ–¥ (80%):'},
                'breakdownWMV': {'en': 'WMV Contribution (20%):', 'ro': 'Contribu»õia WMV (20%):', 'ru': '–í–∫–ª–∞–¥ WMV (20%):'},
                'breakdownTotal': {'en': 'Unadjusted Total:', 'ro': 'Total Neajustat:', 'ru': '–ù–µ—Å–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ò—Ç–æ–≥:'},
                
                'medalTitle': {'en': 'üèÖ Career Medals', 'ro': 'üèÖ Medalii √Æn CarierƒÉ', 'ru': 'üèÖ –ö–∞—Ä—å–µ—Ä–Ω—ã–µ –ú–µ–¥–∞–ª–∏'},
                'medalGold': {'en': 'Gold', 'ro': 'Aur', 'ru': '–ó–æ–ª–æ—Ç–æ'},
                'medalSilver': {'en': 'Silver', 'ro': 'Argint', 'ru': '–°–µ—Ä–µ–±—Ä–æ'},
                'medalBronze': {'en': 'Bronze', 'ro': 'Bronz', 'ru': '–ë—Ä–æ–Ω–∑–∞'},
                
                'historyTitle': {'en': 'üèÖ Competition History', 'ro': 'üèÖ Istoricul Competi»õiilor', 'ru': 'üèÖ –ò—Å—Ç–æ—Ä–∏—è –°–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π'},
                'historyTournament': {'en': 'Tournament', 'ro': 'Turneu', 'ru': '–¢—É—Ä–Ω–∏—Ä'},
                'historyPlacement': {'en': 'Placement', 'ro': 'Clasament', 'ru': '–ú–µ—Å—Ç–æ'},
                'historyYear': {'en': 'Year', 'ro': 'An', 'ru': '–ì–æ–¥'},
                'noHistory': {'en': 'No competition history recorded.', 'ro': 'Niciun istoric al competi»õiilor √Ænregistrat.', 'ru': '–ò—Å—Ç–æ—Ä–∏—è —Å–æ—Ä–µ–≤–Ω–æ–≤–∞–Ω–∏–π –Ω–µ –∑–∞–ø–∏—Å–∞–Ω–∞.'},
                'winPercentLabel': {'en': 'Win %:', 'ro': 'Rata C√¢»ôtigului %:', 'ru': '–ü—Ä–æ—Ü–µ–Ω—Ç –ü–æ–±–µ–¥ %:'},
                
                // RANK BADGE LOCALIZATION
                'accoladesTitle': {'en': 'üëë Elite Status & Accolades', 'ro': 'üëë Statut Elite »ôi Recunoa»ôteri', 'ru': 'üëë –≠–ª–∏—Ç–Ω—ã–π –°—Ç–∞—Ç—É—Å –∏ –ù–∞–≥—Ä–∞–¥—ã'},
                'noAccolades': {'en': 'No current #1 rankings achieved.', 'ro': 'Niciun clasament #1 actual ob»õinut.', 'ru': '–¢–µ–∫—É—â–∏—Ö —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ #1 –Ω–µ –ø–æ–ª—É—á–µ–Ω–æ.'},
                'badgeOverall': {'en': 'WORLD #1', 'ro': '#1 GLOBAL', 'ru': '#1 –ú–ò–†'},
                'badgeCountry': {'en': 'COUNTRY #1', 'ro': '#1 »öARƒÇ', 'ru': '#1 –°–¢–†–ê–ù–ê'},
                'badgeDivision': {'en': '#1 DIVISION', 'ro': '#1 DIVIZIE', 'ru': '#1 –î–ò–í–ò–ó–ò–û–ù'},
                'badgeCategory': {'en': '#1 CATEGORY', 'ro': '#1 CATEGORIE', 'ru': '#1 –ö–ê–¢–ï–ì–û–†–ò–Ø'}
            };
            
            let currentLang = 'en';

            // --- Country Code Mapping (ISO 2 for FlagCDN) ---
            function getCountryCodes(country) {
                switch (country) {
                    case "Moldova": return { iso2: "md", name: "Moldova" };
                    case "Russia": return { iso2: "ru", name: "Russia" };
                    case "Romania": return { iso2: "ro", name: "Romania" };
                    case "Italy": return { iso2: "it", name: "Italy" };
                    case "India": return { iso2: "in", name: "India" };
                    case "Irland": return { iso2: "ie", name: "Ireland" };
                    case "UK": return { iso2: "gb", name: "United Kingdom" };
                    default: return { iso2: "un", name: "Unknown" };
                }
            }
            
            function getFlagImgTag(country) {
                const { iso2, name } = getCountryCodes(country);
                const url = `https://flagcdn.com/${iso2}.svg`; 
                return `<img src="${url}" alt="${name} flag" class="flag-img">`;
            }

            // --- Helper function to calculate win percentage for sorting ---
            function calculateWinPercentage(ratioString) {
                const parts = ratioString.split(' ')[0].split('-');
                const wins = parseInt(parts[0]);
                const losses = parseInt(parts[1]);
                const total = wins + losses;
                if (total === 0) return 0;
                return (wins / total) * 100;
            }
            
            // --- Medal Calculation Logic (Traditional) ---
            function calculateMedals(history) {
                const medals = { Gold: 0, Silver: 0, Bronze: 0 };
                history.forEach(event => {
                    if (event.place.includes('1st')) medals.Gold++;
                    else if (event.place.includes('2nd')) medals.Silver++;
                    else if (event.place.includes('3rd')) medals.Bronze++;
                });
                return medals;
            }
            
            // --- Weighted Medal Value (WMV) Calculation ---
            function calculateWeightedMedalValue(history) {
                let wmv = 0;
                // Define how much each placement type is weighted
                const placementWeight = {
                    '1st': 3, // Gold
                    '2nd': 2, // Silver
                    '3rd': 1  // Bronze
                };

                history.forEach(event => {
                    const difficulty = event.difficulty || 1; // Default to 1 if missing
                    let placeFactor = 0;
                    
                    if (event.place.includes('1st')) placeFactor = placementWeight['1st'];
                    else if (event.place.includes('2nd')) placeFactor = placementWeight['2nd'];
                    else if (event.place.includes('3rd')) placeFactor = placementWeight['3rd'];
                    
                    wmv += difficulty * placeFactor;
                });
                return wmv;
            }
            
            // --- Next Match Win Probability Calculation ---
            function calculateWinProbability(fighter) {
                const winPercent = calculateWinPercentage(fighter.winRatio);
                const wmv = calculateWeightedMedalValue(fighter.competition_history);
                
                const MAX_WMV = 50; 
                const normalizedWmv = Math.min(wmv, MAX_WMV) / MAX_WMV; 
                
                const WIN_RATIO_WEIGHT = 0.8;
                const WMV_WEIGHT = 0.2;
                
                const wmvContribution = normalizedWmv * WMV_WEIGHT * 100;
                const ratioContribution = winPercent * WIN_RATIO_WEIGHT;
                
                let unadjustedTotal = ratioContribution + wmvContribution;
                let probability = unadjustedTotal;
                
                probability = Math.min(Math.max(probability, 10), 95);

                return {
                    finalProbability: probability.toFixed(0),
                    ratioContribution: ratioContribution.toFixed(1),
                    wmvContribution: wmvContribution.toFixed(1),
                    unadjustedTotal: unadjustedTotal.toFixed(1)
                }; 
            }
            
            // --- Function to check if a fighter is #1 in specific contexts ---
            function getFighterRanks(fighterId) {
                const fighter = fighters.find(f => f.id === fighterId);
                if (!fighter) return { isOverall: false, isCountry: false, isDivision: false, isCategory: false };
                
                // Helper to sort and check the #1 position
                const isRankOne = (list) => {
                    if (list.length === 0) return false;
                    list.sort((a, b) => calculateWinPercentage(b.winRatio) - calculateWinPercentage(a.winRatio));
                    return list[0].id === fighterId;
                };
                
                const ranks = {};

                // 1. Overall #1
                ranks.isOverall = isRankOne(fighters);

                // 2. Country #1
                const countryFighters = fighters.filter(f => f.country === fighter.country);
                ranks.isCountry = isRankOne(countryFighters);
                
                // 3. Division #1 (e.g., Senior, Junior, Cadet)
                const divisionFighters = fighters.filter(f => f.division === fighter.division);
                ranks.isDivision = isRankOne(divisionFighters);

                // 4. Detailed Category #1 (e.g., Senior-Light)
                const categoryFighters = fighters.filter(f => 
                    f.division === fighter.division && f.weight_category === fighter.weight_category
                );
                ranks.isCategory = isRankOne(categoryFighters);
                
                return ranks;
            }

            // --- 1. Taekwondo Fighter Data (UPDATED with weight_category) ---
            let fighters = [
                {
                    id: 1, name: "Caraman Mark", country: "Moldova", division: "Senior",
                    winRatio: "6-0", weight_class_detailed: "-57kg", weight_category: "Light", status: "Coach",
                    competition_history: [
                        { name: "Mini 7-B Grand Open", place: "1st place", year: 2025, difficulty: 8 }, 
                        { name: "Mini 7-B Grand Series", place: "1st place", year: 2025, difficulty: 5 }
                    ]
                },
                {
                    id: 2, name: "David Lupu", country: "Russia", division: "Junior",
                    winRatio: "1-1", weight_class_detailed: "-57kg", weight_category: "Light", status: "Coach",
                    competition_history: [
                        { name: "Mini 7-B Grand Series", place: "2nd place", year: 2025, difficulty: 5 }
                    ]
                },
                {
                    id: 3, name: "Leu Alexandru", country: "Romania", division: "Junior",
                    winRatio: "3-0", weight_class_detailed: "-55kg", weight_category: "Light", status: "Active",
                    competition_history: [
                        { name: "Autumn Fights Open", place: "1st place", year: 2025, difficulty: 2 } 
                    ]
                },
                {
                    id: 4, name: "Tihon Branzanu", country: "Italy", division: "Junior",
                    winRatio: "2-1", weight_class_detailed: "-55kg", weight_category: "Light", status: "Active",
                    competition_history: [
                        { name: "Autumn Fights Open", place: "2nd place", year: 2025, difficulty: 2 }
                    ]
                },
                {
                    id: 5, name: "Gabi Balaban", country: "India", division: "Cadet",
                    winRatio: "1-1", weight_class_detailed: "-55kg", weight_category: "Light", status: "Active",
                    competition_history: [
                        { name: "Autumn Fights Open", place: "3rd place", year: 2025, difficulty: 2 } 
                    ]
                },
                {
                    id: 6, name: "Sementov Vladimir", country: "Russia", division: "Senior",
                    winRatio: "0-0", weight_class_detailed: "+55kg", weight_category: "Heavy", status: "Active",
                    competition_history: [
                        { name: "N/A", place: "N/A", year: 2025, difficulty: 0 }
                    ]
                },
                {
                    id: 7, name: "Volchivski Kiril", country: "Irland", division: "Cadet",
                    winRatio: "0-0", weight_class_detailed: "-55kg", weight_category: "Light", status: "Active",
                    competition_history: [
                        { name: "N/A", place: "N/A", year: 2025, difficulty: 0 }
                    ]
                },
                {
                    id: 8, name: "Frunza Fabian", country: "UK", division: "Senior",
                    winRatio: "0-0", weight_class_detailed: "+55kg", weight_category: "Heavy", status: "Active",
                    competition_history: [
                        { name: "N/A", place: "N/A", year: 2025, difficulty: 0 }
                    ]
                },
                {
                    id: 9, name: "Papanaga Nicolae", country: "Italy", division: "Cadet",
                    winRatio: "0-0", weight_class_detailed: "+55kg", weight_category: "Heavy", status: "Active",
                    competition_history: [
                        { name: "N/A", place: "N/A", year: 2025, difficulty: 0 }
                    ]
                },
                {
                    id: 10, name: "Boescu Daniel", country: "Romania", division: "Junior",
                    winRatio: "0-0", weight_class_detailed: "-55kg", weight_category: "Light", status: "Active",
                    competition_history: [
                        { name: "N/A", place: "N/A", year: 2025, difficulty: 0 }
                    ]
                },
                {
                    id: 11, name: "Catana Gheorghe", country: "Moldova", division: "Cadet",
                    winRatio: "1-1", weight_class_detailed: "+55kg", weight_category: "Heavy", status: "Coach",
                    competition_history: [
                        { name: "Mini 7-B Grand Series", place: "3rd place", year: 2025, difficulty: 5 } 
                    ]
                },
                {
                    id: 12, name: "Lozinschi Bogdan-Eric", country: "Romania", division: "Senior",
                    winRatio: "0-2", weight_class_detailed: "+55kg", weight_category: "Heavy", status: "Active",
                    competition_history: [
                        { name: "Autumn Fights Open", place: "4th Place", year: 2025, difficulty: 2 }
                    ]
                }
            ];
            
            // --- 2. DOM Elements and Initialization ---
            const leaderboardList = document.getElementById('leaderboard-list');
            const fighterDetail = document.getElementById('fighter-detail');
            const initialMessage = document.getElementById('initial-message');
            const divisionFilter = document.getElementById('division-filter');
            const countryFilter = document.getElementById('country-filter'); 
            const themeToggle = document.getElementById('theme-toggle');
            const languageSwitch = document.getElementById('language-switch'); 
            const leaderboardHeading = document.getElementById('leaderboard-heading');
            const breakdownToggle = document.getElementById('breakdown-toggle');
            const probabilityBreakdown = document.getElementById('probability-breakdown');
            const accoladesSection = document.getElementById('accolades-section');
            
            
            // Function to populate the Country Filter dropdown
            function populateCountryFilter() {
                const countries = [...new Set(fighters.map(f => f.country))].sort();
                countries.forEach(country => {
                    const option = document.createElement('option');
                    option.value = country;
                    option.textContent = country;
                    countryFilter.appendChild(option);
                });
            }

            // --- Localization Function ---
            function updateTextContent(lang) {
                currentLang = lang;
                const elements = document.querySelectorAll('[data-localize]');
                
                elements.forEach(element => {
                    const key = element.getAttribute('data-localize');
                    const translation = localizationData[key] ? localizationData[key][lang] : null;
                    
                    if (translation) {
                        // Special handling for the initial message to retain strong tags
                        if (key === 'initialMessage') {
                            element.innerHTML = translation;
                        } else {
                            element.textContent = translation;
                        }
                    }
                });
                
                // Re-render leaderboard to update dynamic headings
                renderLeaderboard();
                
                // If a fighter is currently displayed, refresh the analysis view to update labels and badges
                if (!fighterDetail.classList.contains('hidden') && fighterDetail.getAttribute('data-current-fighter')) {
                     const currentId = parseInt(fighterDetail.getAttribute('data-current-fighter'));
                     displayFighterAnalysis(currentId);
                }
                
                // Update toggle button text if it is open
                if(probabilityBreakdown.classList.contains('visible')) {
                    breakdownToggle.textContent = localizationData.toggleHideBreakdown[currentLang];
                    breakdownToggle.prepend('‚äü ');
                } else {
                    breakdownToggle.textContent = localizationData.toggleShowBreakdown[currentLang];
                    breakdownToggle.prepend('‚äû ');
                }
            }
            
            // --- 3. Filter and Render Leaderboard ---
            function renderLeaderboard() {
                leaderboardList.innerHTML = ''; 
                
                const selectedFilter = divisionFilter.value;
                const selectedCountry = countryFilter.value; 

                let filteredFighters = fighters;
                
                // 3a. Apply Filters
                
                if (selectedFilter !== 'All') {
                    // Check if filter is detailed (e.g., "Senior-Light")
                    if (selectedFilter.includes('-')) {
                        const [division, category] = selectedFilter.split('-');
                        filteredFighters = filteredFighters.filter(f => 
                            f.division === division && f.weight_category === category
                        );
                        // Update heading for detailed filter
                        const localKey = division.toLowerCase() + category;
                        leaderboardHeading.innerHTML = `üèÜ ${localizationData[localKey][currentLang]} ${localizationData.analysisHeading[currentLang]}`;
                    } else {
                        // Filter by Division only (e.g., "Senior")
                        filteredFighters = filteredFighters.filter(f => f.division === selectedFilter);
                        leaderboardHeading.innerHTML = `üèÜ ${selectedFilter} ${localizationData.analysisHeading[currentLang]}`;
                    }
                }
                
                if (selectedCountry !== 'All') {
                    filteredFighters = filteredFighters.filter(f => f.country === selectedCountry);
                    // Adjust heading to reflect country filter (overwrites division if needed)
                    let baseTitle = selectedFilter === 'All' ? localizationData.divisionAll[currentLang] : divisionFilter.options[divisionFilter.selectedIndex].textContent;
                    leaderboardHeading.innerHTML = `üåç ${selectedCountry} - ${baseTitle}`; 
                } else if (selectedFilter === 'All') {
                    // Default heading if no filters applied
                    leaderboardHeading.innerHTML = localizationData.leaderboardHeading[currentLang];
                }


                
                // 3b. Sort by Win Percentage
                filteredFighters.sort((a, b) => {
                    const percentA = calculateWinPercentage(a.winRatio);
                    const percentB = calculateWinPercentage(b.winRatio);
                    return percentB - percentA;
                });
                
                if (filteredFighters.length === 0) {
                    leaderboardList.innerHTML = `<li style="justify-content: center; color: #aaa; display: block; cursor: default;">${localizationData.noHistory[currentLang]}</li>`;
                    return;
                }
                
                // 3c. Render the List
                filteredFighters.forEach((fighter, index) => {
                    const listItem = document.createElement('li');
                    listItem.setAttribute('data-fighter-id', fighter.id);
                    
                    const winPercent = calculateWinPercentage(fighter.winRatio).toFixed(0);
                    const statusHtml = `<span class="status-badge ${fighter.status}">${fighter.status}</span>`;
                    const ratioHtml = `${fighter.winRatio} (${winPercent}%)`;
                    

                    listItem.innerHTML = `
                        <span class="rank">${index + 1}</span>
                        <span class="name-container">
                            ${getFlagImgTag(fighter.country)}
                            ${fighter.name}
                        </span>
                        <span class="stats-container">
                            ${statusHtml} 
                            <span class="ratio-display">${ratioHtml}</span>
                        </span>
                    `;
                    
                    // Direct click listener
                    listItem.addEventListener('click', () => displayFighterAnalysis(fighter.id)); 
                    
                    leaderboardList.appendChild(listItem);
                });
            }
            
            // --- 4. Single Fighter Detail View (UPDATED with Accolades Section) ---
            function displayFighterAnalysis(fighterId) {
                const fighter = fighters.find(f => f.id === fighterId);
                if (!fighter) return;

                initialMessage.classList.add('hidden');
                fighterDetail.classList.remove('hidden');
                fighterDetail.style.opacity = '0';
                fighterDetail.setAttribute('data-current-fighter', fighterId); 
                
                setTimeout(() => {
                    
                    // 4a. Check Ranks and Prepare Badges
                    const ranks = getFighterRanks(fighter.id);
                    const badges = [];
                    
                    // Add badges with a priority score (lower is higher priority)
                    if (ranks.isOverall) {
                         badges.push({ key: 'badgeOverall', priority: 1 });
                    }
                    if (ranks.isCategory) {
                        badges.push({ key: 'badgeCategory', priority: 2 });
                    }
                    if (ranks.isDivision) {
                        badges.push({ key: 'badgeDivision', priority: 3 });
                    }
                    if (ranks.isCountry) {
                        badges.push({ key: 'badgeCountry', priority: 4 });
                    }
                    
                    // Sort badges by priority (best to worst)
                    badges.sort((a, b) => a.priority - b.priority);

                    let badgesHtml = '';
                    if (badges.length > 0) {
                        badges.forEach(badge => {
                            const text = localizationData[badge.key][currentLang];
                            badgesHtml += `<span class="rank-badge">${text}</span>`;
                        });
                    } else {
                        badgesHtml = `<p class="no-badges">${localizationData.noAccolades[currentLang]}</p>`;
                    }
                    
                    // Render Accolades Section
                    accoladesSection.innerHTML = badgesHtml;
                    
                    
                    // 4b. Populate Details
                    document.getElementById('fighter-name').innerHTML = `
                        ${getFlagImgTag(fighter.country)} 
                        ${fighter.name}
                    `;
                    
                    const statusBadge = `<span class="status-badge ${fighter.status}">${fighter.status}</span>`;
                    document.getElementById('fighter-status').innerHTML = statusBadge;

                    document.getElementById('fighter-division').textContent = `${fighter.division} (${fighter.weight_category})`;
                    document.getElementById('weight-class').textContent = fighter.weight_class_detailed; 
                    document.getElementById('country-display').textContent = fighter.country;
                    
                    // Display Win/Loss Ratio
                    const winPercent = calculateWinPercentage(fighter.winRatio).toFixed(1);
                    const ratioLabel = localizationData.winPercentLabel[currentLang];
                    document.getElementById('win-loss').textContent = `${fighter.winRatio} (${ratioLabel} ${winPercent}%)`;
                    
                    // Display Weighted Medal Value
                    const wmv = calculateWeightedMedalValue(fighter.competition_history);
                    document.getElementById('weighted-medal-score').textContent = wmv.toFixed(0); 
                    
                    // Calculate Win Probability and Breakdown
                    const probabilityData = calculateWinProbability(fighter);
                    document.getElementById('probability-score').textContent = `${probabilityData.finalProbability}%`;
                    
                    // Populate Probability Breakdown
                    document.getElementById('ratio-contribution').textContent = `${probabilityData.ratioContribution}%`;
                    document.getElementById('wmv-contribution').textContent = `${probabilityData.wmvContribution}%`;
                    document.getElementById('unadjusted-total').textContent = `${probabilityData.unadjustedTotal}%`;
                    
                    // Populate Medal Count
                    const medals = calculateMedals(fighter.competition_history);
                    const medalContainer = document.getElementById('medal-count');
                    medalContainer.innerHTML = `
                        <div style="text-align: center;">
                            <span class="medal-icon" style="color: var(--gold);">ü•á</span><br>
                            <strong>${medals.Gold}</strong> ${localizationData.medalGold[currentLang]}
                        </div>
                        <div style="text-align: center;">
                            <span class="medal-icon" style="color: var(--silver);">ü•à</span><br>
                            <strong>${medals.Silver}</strong> ${localizationData.medalSilver[currentLang]}
                        </div>
                        <div style="text-align: center;">
                            <span class="medal-icon" style="color: var(--bronze);">ü•â</span><br>
                            <strong>${medals.Bronze}</strong> ${localizationData.medalBronze[currentLang]}
                        </div>
                    `;
                    
                    // Populate Competition History Table
                    const historyBody = document.getElementById('history-body');
                    historyBody.innerHTML = '';
                    
                    // Handle "no competitions" case specifically
                    if (fighter.competition_history.length === 0 || (fighter.competition_history.length === 1 && fighter.competition_history[0].name === "N/A")) {
                        historyBody.innerHTML = `<tr><td colspan="3" style="text-align: center; font-style: italic;">${localizationData.noHistory[currentLang]}</td></tr>`;
                    } else {
                        fighter.competition_history.forEach(event => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
                                <td>${event.name}</td>
                                <td><strong>${event.place}</strong></td>
                                <td>${event.year}</td>
                            `;
                            historyBody.appendChild(row);
                        });
                    }

                    fighterDetail.style.opacity = '1';

                }, 200); 
            }

            // --- 5. Event Listeners ---
            
            // Toggle Breakdown Visibility
            breakdownToggle.addEventListener('click', () => {
                const isVisible = probabilityBreakdown.classList.toggle('visible');
                
                if (isVisible) {
                    breakdownToggle.textContent = localizationData.toggleHideBreakdown[currentLang];
                    breakdownToggle.prepend('‚äü ');
                } else {
                    breakdownToggle.textContent = localizationData.toggleShowBreakdown[currentLang];
                    breakdownToggle.prepend('‚äû ');
                }
            });
            
            // Re-render when filters change
            divisionFilter.addEventListener('change', () => {
                countryFilter.value = 'All'; // Reset country filter when division changes
                renderLeaderboard();
                initialMessage.classList.remove('hidden');
                fighterDetail.classList.add('hidden');
            });
            
            countryFilter.addEventListener('change', () => {
                divisionFilter.value = 'All'; // Reset division filter when country changes
                renderLeaderboard();
                initialMessage.classList.remove('hidden');
                fighterDetail.classList.add('hidden');
            });
            
            // Theme Toggle Listener
            themeToggle.addEventListener('change', (e) => {
                document.body.setAttribute('data-theme', e.target.value);
            });
            
            // Language Switch Listener
            languageSwitch.addEventListener('change', (e) => {
                updateTextContent(e.target.value);
            });


            // Initialize the site
            populateCountryFilter();
            updateTextContent('en'); 
        });
    </script>
</body>
</html>